---
id: 5ee26439af38b667a8ca6663
title: "動漫瘋彈幕轉換 ASS 工具"
feature_image: /content/images/2020/06/3KDAYtE.png
description: "時間差(單位為秒):取得
進度狀態:"
date: 2020-06-03
tags: page
slug: baha-danmu-to-ass
layout: layouts/page.njk
---
<!--
<!--kg-card-begin: html--><input id="param" placeholder="請輸入網站網址或者 sn ID" />
時間差(單位為秒):<input type="number" id="offset" style="width: 20%" value="0" /><button id="get">取得</button>
<span>進度狀態: <span id="status"></span></span>

<script>
(() => {
  const status = document.getElementById("status");
  const screenX = 1920;
  const screenY = 1080;
  const danmutime = 10;
  const danmutimeFixed = 5;
  const spaceHeight = 50;
  const centerOffsetY = 140;
  const fontSize = 40;
  let offset = 0; // 影片開頭如果有差異可以調這個，單位是秒
  const template = `
[Script Info]
; Script generated by Aegisub r8942
; http://www.aegisub.org/
ScriptType: v4.00+
ScaledBorderAndShadow: no
PlayResX: ${screenX}
PlayResY: ${screenY}
Timer: 100.0000
Title:
Original Script:
Original Translation:
Original Editing:
Original Timing:
Script Updated
Update Details:
WrapStyle: 0
YCbCr Matrix: TV.601

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: ED_JP,TelopMinProN-E,60,&H19FFFFFF,&H000000FF,&H00000000,&H19000000,0,0,0,0,100,100,1,0,1,1.5,1,8,50,50,30,1
Style: ED_SC,SourceHanSerifSC-Bold,55,&H19FFFFFF,&H000000FF,&H00000000,&H19000000,0,0,0,0,100,100,4.5,0,1,1.5,1,2,50,50,40,1
Style: ED_TC,SourceHanSerifK-Bold,55,&H19FFFFFF,&H000000FF,&H00000000,&H19000000,0,0,0,0,100,100,4.5,0,1,1.5,1,2,50,50,40,1
Style: Main,FZLiBian-S02,${fontSize},&H00FFFFFF,&H00FFFFFF,&H00000000,&H00000000,-1,0,0,0,100,100,2,0,1,2,2,2,60,60,30,1
Style: Story,FZKai-Z03,55,&H00FFFFFF,&H00FFFFFF,&H00000000,&H00000000,-1,0,0,0,100,100,3,0,1,2,2,2,60,60,30,1
Style: Annotation_SC,SourceHanSerifSC-Bold,40,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,1,1,7,30,30,30,1
Style: Annotation_TC,SourceHanSerifK-Bold,40,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,1,1,7,30,30,30,1
Style: Staff_SC,SourceHanSerifSC-Bold,40,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,1,1,8,30,30,30,1
Style: Staff_TC,SourceHanSerifK-Bold,40,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,1,1,8,30,30,30,1
Style: Draw,Arial,20,&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,0,0,2,10,10,10,1
{{style}}

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
{{subtitle}}
  `;
  const parseDanmu = (danmu) => {
    const subStack = {};
    const subStackForCenter = {};
    const colorStack = {};
    const styles = [];
    const parseDanmu = danmu.map((dan, i) => {
      status.innerHTML = `解析第${i}個...`;
      const danTime = dan.time + offset * danmutime;
      let textOffset =
        dan.text.length * 60 - (dan.text.match(/[AZaz09]/g) || []).length * 30;
      let posY = 0;
      let color = "";
      const time = [
        parseInt(danTime / 36000), // hour
        parseInt(
          parseInt((danTime / 600) % 60)
            .toString()
            .padStart(2, 0)
        ), // minute
        parseInt(((danTime / 10) % 60).toString().padStart(2, 0)), //sec
        danTime % 10 //million sec
      ];

      if (time[0] > 0) console.log(time);

      if (dan.position == 0) {
        if (subStack[parseInt(danTime / 100)] == undefined) {
          subStack[parseInt(danTime / 100)] = 1;
        } else {
          subStack[parseInt(danTime / 100)]++;
        }

        posY =
          (subStack[parseInt(danTime / 100)] * spaceHeight) %
          (screenY - spaceHeight);
      } else {
        if (subStackForCenter[parseInt(danTime / 120)] == undefined) {
          subStackForCenter[parseInt(danTime / 120)] = 1;
        } else {
          subStackForCenter[parseInt(danTime / 120)]++;
        }

        posY =
          screenY -
          centerOffsetY -
          subStackForCenter[parseInt(danTime / 120)] * spaceHeight;
      }

      if (posY < spaceHeight) posY = spaceHeight;

      // color
      if (dan.color != "#FFFFFF") {
        if (!colorStack[dan.color]) {
          colorStack[dan.color] = true;
          //#rrggbb
          styles.push(
            `Style: ${
              dan.color
            },FZLiBian-S02,${fontSize},&H00${dan.color.substr(
              5,
              2
            )}${dan.color.substr(3, 2)}${dan.color.substr(
              1,
              2
            )},&H00FFFFFF,&H00000000,&H00000000,-1,0,0,0,100,100,2,0,1,2,2,2,60,60,30,1\n`
          );
        }
        color = dan.color;
      } else {
        color = "Main";
      }

      if (dan.position == 0) {
        return `Dialogue: 0,${time[0]}:${time[1]}:${time[2]}.${time[3]},${
          time[0]
        }:${time[1]}:${time[2] + danmutime}.${
          time[3]
        },${color},,0,0,0,,{\\move(${screenX + textOffset}, ${posY}, ${
          textOffset * -1
        }, ${posY})}${dan.text}\n`;
      } else {
        return `Dialogue: 0,${time[0]}:${time[1]}:${time[2]}.${time[3]},${
          time[0]
        }:${time[1]}:${time[2] + danmutimeFixed}.${
          time[3]
        },${color},,0,0,0,,{\\pos(960,${posY})}${dan.text}\n`;
      }
    });
    console.log(subStack);
    console.log(colorStack);
    status.innerHTML = `產生下載檔案`;
    return template
      .replace("{{subtitle}}", parseDanmu.join(""))
      .replace("{{style}}", styles.join(""));
  };

  const getAss = async (sn) => {
    status.innerHTML = "取得彈幕中...";
    const data = await fetch(`https://baha.bgpsekai.club/baha/dammu/${sn}`);
    saveData(parseDanmu(await data.json()), `${sn}.ass`);
  };

  const saveData = (function () {
    var a = document.createElement("a");
    document.body.appendChild(a);
    a.style = "display: none";
    return function (data, fileName) {
      var json = data,
        blob = new Blob([json], { type: "data:attachment/text" }),
        url = window.URL.createObjectURL(blob);
      a.href = url;
      a.download = fileName;
      a.click();
      window.URL.revokeObjectURL(url);
    };
  })();

  document.querySelector("#get").addEventListener("click", () => {
    const data = document
      .getElementById("param")
      .value.match(/ani\.gamer\.com\.tw\/animeVideo.php\?sn=(\d{1,})/);
    offset = parseInt(document.getElementById("offset").value);
    if (data && data.length > 1) {
      getAss(data[1]);
    } else if (document.getElementById("param").value.match(/\d{1,}/)) {
      getAss(document.getElementById("param").value);
    } else {
      status.innerHTML = "錯誤, 請輸入正確格式";
    }
  });
})();

</script><!--kg-card-end: html--><p>網站需要你的支持，請查看廣告</p><!--kg-card-begin: html--><ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-9488921689181013"
     data-ad-slot="1236400059"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins><!--kg-card-end: html-->

這是一個巴哈動漫瘋彈幕的轉換工具，可以直接轉換成 ASS 外掛字幕讓你搭配任何你想要的播放器使用

### 工具使用教學

將網址貼入輸入框並且點擊`取得`即可，就這麼簡單
`範例網址:https://ani.gamer.com.tw/animeVideo.php?sn=15577`
時間差則可以依據影片調整彈幕的開始時間

### 彈幕使用說明

建議搭配 Potplayer 並將彈幕字幕拖進第二字幕即可

#### 更新日誌

```
2021/09/08 感謝網友 NiGHTsC 提供問題回報，修復超過一小時以上無法正確顯示時間的問題
2020/11/21 修正非 PotPlayer 無法以正確比例播放字幕
2020/09/27 修正置中彈幕擋住字幕的問題
```



有任何問題請聯絡 [a9656015@gmail.com](mailto:a9650615@gmail.com) 進行詢問 -->
